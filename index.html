<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AR Zombie Shooter (Marker)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- A-Frame & AR.js STABLE VERSIONS -->
<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ar.js@3.3.2/aframe/build/aframe-ar.min.js"></script>

<style>
body { margin:0; overflow:hidden; font-family:sans-serif; }
.hud { position:fixed; top:0; left:0; right:0; padding:8px; display:flex; gap:8px; z-index:10; }
.pill { background:rgba(0,0,0,.6); color:#fff; padding:6px 12px; border-radius:100px; font-size:12px; }
#startBtn { position:fixed; bottom:15px; left:50%; transform:translateX(-50%);
 background:#1e90ff; color:white; padding:14px 24px; border-radius:12px; font-size:16px; z-index:10; }
</style>
</head>

<body>

<!-- HUD -->
<div class="hud">
  <div class="pill">‚è± <span id="time">60</span>s</div>
  <div class="pill">üíØ <span id="score">0</span></div>
  <div class="pill">üßü <span id="alive">1</span></div>
</div>
<button id="startBtn">Mulai Game</button>

<!-- AR Scene -->
<a-scene
  embedded
  vr-mode-ui="enabled:false"
  renderer="antialias:true; alpha:true"
  arjs="sourceType: webcam; facingMode: environment; debugUIEnabled: false">
  
  <!-- Lights -->
  <a-entity light="type: ambient; intensity: 1"></a-entity>
  <a-entity light="type: directional; intensity: 0.8" position="0 1 1"></a-entity>

  <!-- Marker -->
  <a-marker id="marker" preset="hiro" emitevents="true">
    <a-cylinder radius="0.4" height="0.01" color="#222" material="opacity:0.2" rotation="90 0 0"></a-cylinder>

    <!-- Zombie -->
    <a-entity id="z1" zombie pop-on-hit class="target" position="0.25 0 0.25"></a-entity>
  </a-marker>

  <!-- Camera -->
  <a-entity camera></a-entity>
  <a-entity id="cursor" cursor="rayOrigin: mouse" raycaster="objects: .target"></a-entity>

</a-scene>

<script>
/* Primitive Zombie */
AFRAME.registerComponent("zombie", {
  schema: {speed:{default:0.12}},
  init() {
    const body = document.createElement("a-box");
    body.setAttribute("width","0.15"); body.setAttribute("height","0.25"); body.setAttribute("depth","0.1");
    body.setAttribute("color","#2b2b2b"); body.setAttribute("position","0 0.15 0");
    this.el.appendChild(body);

    const head = document.createElement("a-sphere");
    head.setAttribute("radius","0.08"); head.setAttribute("color","#4a9658"); head.setAttribute("position","0 0.32 0");
    this.el.appendChild(head);

    const ring = document.createElement("a-ring");
    ring.setAttribute("radius-inner","0.03"); ring.setAttribute("radius-outer","0.05");
    ring.setAttribute("color","#ffcc00"); ring.setAttribute("rotation","-90 0 0");
    this.el.appendChild(ring);

    this.phase = Math.random()*Math.PI*2;
  },
  tick(t,dt){
    const p=this.el.object3D.position.clone();
    const center=new THREE.Vector3(0,p.y,0);
    const dir = center.sub(p);
    if(dir.length()>0.0001){
      dir.normalize();
      const step=(this.data.speed*(dt||16)/1000);
      this.el.object3D.position.addScaledVector(dir,step);
    }
    if(p.length()<0.05) window.dispatchEvent(new Event("gameOver"));
  }
});

/* Pop on hit animate + remove */
AFRAME.registerComponent("pop-on-hit", {
  init(){
    this.el.addEventListener("hit",()=>{
      this.el.setAttribute("animation__s","property: scale; to:0.01 0.01 0.01; dur:120; easing:easeInBack");
      setTimeout(()=> this.el.parentNode?.removeChild(this.el),140);
    });
  }
});

/* GAME LOGIC */
let score=0, time=60, alive=1, timer=null;
const scoreEl=document.querySelector("#score");
const timeEl=document.querySelector("#time");
const aliveEl=document.querySelector("#alive");
const marker=document.querySelector("#marker");
const cursor=document.querySelector("#cursor");

/* Click to shoot */
document.querySelector("a-scene").addEventListener("click",()=>{
  const hits = cursor.components.raycaster.intersections;
  const hit = hits[0]?.object?.el;
  if(hit && hit.classList.contains("target")){
    score+=10; alive--;
    scoreEl.textContent=score; aliveEl.textContent=alive;
    hit.emit("hit");
  }
});

/* Spawn Zombie */
function spawnZombie(){
  const e=document.createElement("a-entity");
  e.classList.add("target");
  e.setAttribute("zombie","");
  e.setAttribute("pop-on-hit","");
  const r=0.25+Math.random()*0.25, a=Math.random()*Math.PI*2;
  e.setAttribute("position",`${Math.cos(a)*r} 0 ${Math.sin(a)*r}`);
  marker.appendChild(e);
  alive++; aliveEl.textContent=alive;
}

/* Start Game */
document.querySelector("#startBtn").onclick=()=>{
  document.querySelector("#startBtn").style.display="none";
  timer=setInterval(()=>{
    time--; timeEl.textContent=time;
    if(time<=0) endGame();
    if(alive<3) spawnZombie();
  },1000);
};

function endGame(){
  clearInterval(timer);
  alert(`Game Over! Skor Kamu: ${score}`);
  location.reload();
}

/* Zombie reaches center */
window.addEventListener("gameOver",()=>endGame());
</script>
</body>
</html>
